// Nepali calendar data for years 2040-2090
export const nepaliCalendarData: { [key: number]: number[] } = {
  2040: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
  2041: [31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
  2042: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
  2043: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
  2044: [31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
  2045: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
  2046: [31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
  2047: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
  2048: [31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
  2049: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
  2050: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
  2051: [31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
  2052: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
  2053: [31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
  2054: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
  2055: [31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
  2056: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
  2057: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
  2058: [31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
  2059: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
  2060: [31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
  2061: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
  2062: [31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
  2063: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
  2064: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
  2065: [31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
  2066: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
  2067: [31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
  2068: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
  2069: [31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
  2070: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
  2071: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
  2072: [31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
  2073: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
  2074: [31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
  2075: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
  2076: [31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
  2077: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
  2078: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
  2079: [31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
  2080: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
  2081: [31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
  2082: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
  2083: [31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
  2084: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
  2085: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
  2086: [31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
  2087: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
  2088: [31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
  2089: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
  2090: [31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
};

// Base Nepali date for conversion (2040-01-01 BS = 1983-04-14 AD)
const BASE_NEPALI_YEAR = 2040;
const BASE_NEPALI_MONTH = 1;
const BASE_NEPALI_DAY = 1;
const BASE_GREGORIAN_DATE = new Date(1983, 3, 14); // Month is 0-based in JS Date

const nepaliHolidays: { [key: string]: string } = {
  '2082-2-7': 'Buddha Jayanti',
  '2082-2-15': 'Republic Day',
  // Add more holidays as needed
};

export const getNepaliMonthDays = (year: number, month: number): number => {
  if (nepaliCalendarData[year] && nepaliCalendarData[year][month - 1]) {
    return nepaliCalendarData[year][month - 1];
  }
  return 30; // Default fallback
};

export const getNepaliMonthName = (month: number, locale: string): string => {
  const months = {
    en: [
      'Baisakh',
      'Jestha',
      'Ashar',
      'Shrawan',
      'Bhadra',
      'Ashwin',
      'Kartik',
      'Mangsir',
      'Poush',
      'Magh',
      'Falgun',
      'Chaitra',
    ],
    ne: [
      'बैशाख',
      'जेठ',
      'असार',
      'श्रावण',
      'भाद्र',
      'आश्विन',
      'कार्तिक',
      'मंसिर',
      'पुष',
      'माघ',
      'फाल्गुन',
      'चैत्र',
    ],
  };
  return months[locale as keyof typeof months][month - 1];
};

export const getWeekDayName = (day: number, locale: string): string => {
  const weekDays = {
    en: [
      'Sunday',
      'Monday',
      'Tuesday',
      'Wednesday',
      'Thursday',
      'Friday',
      'Saturday',
    ],
    ne: [
      'आइतबार',
      'सोमबार',
      'मंगलबार',
      'बुधबार',
      'बिहिबार',
      'शुक्रबार',
      'शनिबार',
    ],
  };
  return weekDays[locale as keyof typeof weekDays][day];
};

export const generateCalendarDays = (year: number, month: number): number[] => {
  const daysInMonth = getNepaliMonthDays(year, month);
  return Array.from({ length: daysInMonth }, (_, i) => i + 1);
};

export const getCurrentNepaliDate = (): {
  year: number;
  month: number;
  day: number;
} => {
  const today = new Date();
  const diffTime = Math.abs(today.getTime() - BASE_GREGORIAN_DATE.getTime());
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

  let remainingDays = diffDays;
  let nepaliYear = BASE_NEPALI_YEAR;
  let nepaliMonth = BASE_NEPALI_MONTH;
  let nepaliDay = BASE_NEPALI_DAY;

  while (remainingDays > 0) {
    const daysInMonth = getNepaliMonthDays(nepaliYear, nepaliMonth);
    if (remainingDays >= daysInMonth) {
      remainingDays -= daysInMonth;
      nepaliMonth++;
      if (nepaliMonth > 12) {
        nepaliMonth = 1;
        nepaliYear++;
      }
    } else {
      nepaliDay += remainingDays;
      remainingDays = 0;
    }
  }

  return { year: nepaliYear, month: nepaliMonth, day: nepaliDay };
};

export const getAllHolidays = (year: number) => {
  // Note: year parameter is kept for future use when holiday data might vary by year
  const holidays: { [key: string]: { [key: string]: string } } = {
    '1': {
      '1': 'New Year',
      '11': 'Nepali New Year',
      '14': 'Baisakh Sankranti',
    },
    '2': { '15': 'Buddha Jayanti', '30': 'Ganatantra Diwas' },
    '3': { '15': 'Ashadh Sankranti', '29': 'National Paddy Day' },
    '4': { '15': 'Shrawan Sankranti', '20': 'Nag Panchami' },
    '5': {
      '15': 'Janai Purnima',
      '21': 'Gaura Parba',
      '23': 'Krishna Janmashtami',
    },
    '6': { '15': 'Teej', '20': 'Rishi Panchami', '27': 'Indra Jatra' },
    '7': {
      '2': 'Ghatasthapana',
      '7': 'Fulpati',
      '8': 'Maha Astami',
      '9': 'Maha Nawami',
      '10': 'Vijaya Dashami',
      '15': 'Kojagrat Purnima',
    },
    '8': {
      '15': 'Laxmi Puja',
      '17': 'Mha Puja',
      '18': 'Nepal Sambat New Year',
    },
    '9': { '14': "Children's Day", '15': 'Constitution Day' },
    '10': { '15': 'Poush Sankranti', '30': 'Tamu Lhosar' },
    '11': { '15': 'Maghe Sankranti', '30': 'Sonam Lhosar' },
    '12': { '15': 'Fagu Purnima', '24': 'Ghode Jatra' },
  };
  return holidays;
};

export const getNepaliHoliday = (
  year: number,
  month: number,
  day: number
): string | null => {
  const holidays = getAllHolidays(year);
  const monthStr = month.toString();
  const dayStr = day.toString();
  return holidays[monthStr]?.[dayStr] || null;
};

export const getStartDayOfMonth = (year: number, month: number): number => {
  const baseNepaliYear = 2040;
  const baseNepaliMonth = 1; // Baisakh
  const baseNepaliDay = 1;
  const baseWeekDay = 3; // Wednesday (2040-01-01 BS was a Wednesday)

  let totalDays = 0;

  // Calculate total days from base year to the given year
  for (let y = baseNepaliYear; y < year; y++) {
    for (let m = 1; m <= 12; m++) {
      totalDays += getNepaliMonthDays(y, m);
    }
  }

  // Add days for the months in the current year up to the given month
  for (let m = 1; m < month; m++) {
    totalDays += getNepaliMonthDays(year, m);
  }

  // Calculate the weekday
  return (baseWeekDay + totalDays) % 7;
};
